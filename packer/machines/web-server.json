{
    "variables": {
        "aws_access_key":"{{env `AWS_ACCESS_KEY_ID`}}",
        "aws_default_region":"{{env `AWS_DEFAULT_REGION`}}",
        "aws_source_ami":"{{env `AWS_SOURCE_AMI`}}",
        "aws_secret_key":"{{env `AWS_SECRET_ACCESS_KEY`}}",
        "aws_vpc_id": "{{env `PACKER_AWS_VPC_ID`}}",
        "aws_subnet_id": "{{env `PACKER_AWS_SUBNET_ID`}}",
        "google_project": "devops-infra-demo"
    },
    "builders": [{
        "type": "amazon-ebs",
        "access_key": "{{user `aws_access_key`}}",
        "secret_key": "{{user `aws_secret_key`}}",
        "region": "{{user `aws_default_region`}}",
        "source_ami" : "{{user `aws_source_ami`}}",
        "instance_type": "t2.large",
        "subnet_id": "{{user `aws_subnet_id`}}",
        "vpc_id": "{{user `aws_vpc_id`}}",
        "ssh_username": "centos",
        "ami_name": "centos-7-sec-demo-{{timestamp}}",
        "ami_description": "CentOS 7 sec demo"
    }],
    "provisioners": [
        {
            "type": "file",
            "source": "/app/application",
            "destination": "/tmp"
        },
        {
            "type": "shell",
            "inline": [
                "sudo touch /tag",
                "sudo yum -qy install openscap-scanner scap-security-guide",
                "oscap xccdf eval --profile C2S --results scan-xccdf-results.xml /usr/share/xml/scap/ssg/content/ssg-centos7-xccdf.xml",
                "oscap xccdf generate report  scan-xccdf-results.xml > scan -xccdf-report.html"
            ]
        }
    ]
}
